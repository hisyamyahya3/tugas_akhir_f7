<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" 
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Penjualan Berbasis Framework7 v8</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#fff">
    <meta http-equiv="Content-Security-Policy" content="default-src * 'self' 'unsafe-inline' 'unsafe-eval' data:">
    <link rel="stylesheet" href="core/framework7/framework7-bundle.min.css">
    <link rel="stylesheet" href="css/app.css">
    <link rel="apple-touch-icon" href="img/f7-icon-square.png">
    <link rel="icon" href="img/f7-icon.png">
</head>

<body>
    <div id="app">
        <div class="view view-main view-init safe areas" data-master-detail-breakpoint="768" data-url="/"></div>
    </div>
    <script src="core/framework7/framework7-bundle.min.js"></script>
    <script src="js/routes.js"></script>
    <script src="js/store.js"></script>
    <script src="js/app.js"></script>
    <script src="js/jquery-3.6.3.min.js"></script>
    <script src="cordova.js"></script>
    <script src="js/pembelian.js"></script>
    <script>
        function tampilKategori() {
            $.ajax({
                type: "GET",
                url: "http://localhost/api_toko/Kategori",
                success: function(result) {
                    let dt = "";
                    let res = JSON.parse(result);
                    let temp = '';

                    res.data.forEach((d) => {
                        temp += `
                            <tr>
                                <td class="label-cell">${d.kategori_nama}</td>
                                <td class="actions-cell"><p class="grid grid-cols-2 grid-gap"><button class="button button-small button-tonal" onclick="editKategori(${d.kategori_id}, '${d.kategori_nama}')">Edit</button><button class="button button-small button-tonal color-red" onclick="#">Hapus</button></p></td>
                            </tr>
                        `
                    })
                    $('#daftar-kategori').html(temp)    
                }
            })
        }

        function tambahKategori() {
            let kategori_nama = $("input[name=kategori_nama]").val();
            if(kategori_nama == ""){
                app.dialog.alert("Isian Masih Kosong, Silahkan Cek Kembali","Error");
                return;
            }

            $.ajax({
                url: "http://localhost/api_toko/Kategori/insert",
                method: "POST",
                data: {kategori_nama: kategori_nama},
                success: function(){
                    app.dialog.alert("Data Berhasil Di Input","Success");
                    app.views.main.router.back();
                },
                error: function(){
                    app.dialog.alert("Tidak Terhubung dengan Server!","Error");
                }
            })
            // app.dialog.alert(kategori_nama,"Info");
            // app.views.main.router.back();
        }
        
        function editKategori(id, nama) {
            // $('input[name=kategori_nama]').val(id);
            // $('input[name=kategori_nama]').val(nama);

            localStorage.setItem("namaKategori", nama);
            localStorage.setItem("idKategori", id);

            app.views.main.router.navigate("/editktgr/");
            // window.location.href = '/editktgr/';
        }

        function updateKategori(id, nama) {
            let idKategori = localStorage.getItem("idKategori");
            let kategori_nama = $("input[name=kategori_nama]").val();

            if(kategori_nama == ""){
                app.dialog.alert("Isian Masih Kosong, Silahkan Cek Kembali","Error");
                return;
            }

            $.ajax({
                url: "http://localhost/api_toko/Kategori/update",
                method: "POST",
                data: {
                    id_kategori: idKategori,
                    kategori_nama: kategori_nama
                },
                success: function(){
                    app.dialog.alert("Data Berhasil Di Update","Success");
                    app.views.main.router.back();
                },
                error: function(){
                    app.dialog.alert("Tidak Terhubung dengan Server!","Error");
                }
            })
        }

        function tampilBarang() {
            $.ajax({
                type: "GET",
                url: "http://localhost/api_toko/Barang",
                success: function(result) {
                    let dt = "";
                    let res = JSON.parse(result);
                    let temp = '';

                    res.data.forEach((d) => {
                        temp += `
                            <tr>
                                <td class="label-cell">${d.barang_nama}</td>
                                <td class="label-cell">${d.barang_satuan}</td>
                                <td class="numeric-cell">${d.barang_harpok}</td>
                                <td class="numeric-cell">${d.barang_harjul}</td>
                                <td class="numeric-cell">${d.barang_harjul_grosir}</td>
                                <td class="numeric-cell">${d.barang_stok}</td>
                                <td class="numeric-cell">${d.barang_min_stok}</td>
                                <td class="label-cell"><p class="grid grid-cols-2 grid-gap"><button class="button button-small button-tonal" onclick="editBarang(${d.barang_id}, '${d.barang_nama}', '${d.barang_satuan}', ${d.barang_harpok}, ${d.barang_harjul}, ${d.barang_harjul_grosir}, ${d.barang_stok}, ${d.barang_min_stok})">Edit</button><button class="button button-small button-tonal color-red" onclick="#">Hapus</button></p></td>
                          </tr>
                        `
                    })
                    $('#daftar-barang').html(temp)    
                }
            })
        }

        function tambahBarang() {
            let barang_nama = $("input[name=barang_nama]").val();
            let barang_satuan = $("input[name=barang_satuan]").val();
            let barang_harpok = $("input[name=barang_harpok]").val();
            let barang_harjul = $("input[name=barang_harjul]").val();
            let barang_harjul_grosir = $("input[name=barang_harjul_grosir]").val();
            let barang_stok = $("input[name=barang_stok]").val();
            let barang_min_stok = $("input[name=barang_min_stok]").val();
            if(barang_nama == "" || barang_satuan == "" || barang_harpok == "" || barang_harjul == "" || barang_harjul_grosir == "" || barang_stok == "" || barang_min_stok == ""){
                app.dialog.alert("Isian Masih Kosong, Silahkan Cek Kembali","Error");
                return;
            }
            $.ajax({
                url: "http://localhost/api_toko/Barang/insert",
                method: "POST",
                data: {barang_nama: barang_nama, barang_satuan: barang_satuan, barang_harpok: barang_harpok, barang_harjul: barang_harjul, barang_harjul_grosir: barang_harjul_grosir, barang_stok: barang_stok, barang_min_stok: barang_min_stok},
                success: function(){
                    app.dialog.alert("Data Berhasil Di Input","Success");
                    app.views.main.router.back();
                },
                error: function(){
                    app.dialog.alert("Tidak Terhubung dengan Server!","Error");
                }
            })
        }

        function resetBarang() {
            let barang_nama = $("input[name=barang_nama]").val("");
            let barang_satuan = $("input[name=barang_satuan]").val("");
            let barang_harpok = $("input[name=barang_harpok]").val("");
            let barang_harjul = $("input[name=barang_harjul]").val("");
            let barang_harjul_grosir = $("input[name=barang_harjul_grosir]").val("");
            let barang_stok = $("input[name=barang_stok]").val("");
            let barang_min_stok = $("input[name=barang_min_stok]").val("");
            app.dialog.alert("Form Berhasil di Reset","Success");
        }

        function editBarang(id, nama, satuan, harpok, harjul, grosir, stok, min) {
            localStorage.setItem("kodeBarang", id);
            localStorage.setItem("namaBarang", nama);
            localStorage.setItem("satuanBarang", satuan);
            localStorage.setItem("harpokBarang", harpok);
            localStorage.setItem("harjulBarang", harjul);
            localStorage.setItem("grosirBarang", grosir);
            localStorage.setItem("stokBarang", stok);
            localStorage.setItem("minBarang", min);
            app.views.main.router.navigate("/editbrg/");
        }

        $(document).on('keyup', '#searchbarang', function () {
            // alert($(this).val())
            let searchInput = $(this).val()

            if (searchInput.length > 0) {
                $.ajax({
                    url: "http://localhost/api_toko/Barang/search",
                    method: "POST",
                    data: {
                        nama_barang: searchInput
                    },
                    success: function(res) {
                        let data = JSON.parse(res)

                        if (data.data) {
                            $('.content-pembelian .barang').html(fetchDataBarang(data))
                        } else {
                            $('.content-pembelian .barang').html('')
                        }
                    },
                    error: function(){
                        app.dialog.alert("Tidak Terhubung dengan Server!","Error");
                    }
                })
            } else {
                $('.content-pembelian .barang').html('')
            }
        })

        function fetchDataBarang(data) {
            let temp = '';
            // let parseData = JSON.parse(data);

            data.data.forEach((d) => {
                temp += `
                <div class="card">
                    <div class="card-content card-content-padding">
                        <div class="row" style="font-size: 17px;">
                            <div class="col-25" style="text-align: left;">Kode Barang : ${d.barang_id}</div>
                            <div class="col-50" style="font-size: larger;">${d.barang_nama}</div>
                            <div class="col-25" style="text-align: right;">Stok Barang : ${d.barang_stok}</div>
                            <div class="col-25" style="text-align: right;">Rp. ${d.barang_harjul}</div>
                        </div>
                    </div>
                </div>
                `
            });

            return temp;
        }

        function tampilPelanggan() {
            $.ajax({
                type: "GET",
                url: "http://localhost/api_toko/Pelanggan",
                success: function(result) {
                    let dt = "";
                    let res = JSON.parse(result);
                    // console.log(res.data)
                    let temp = '';

                    res.data.forEach((d) => {
                        temp += `
                            <tr>
                                <td class="label-cell" style="width: 40%">${d.pelanggan_nama}</td>
                                <td class="label-cell" style="width: 20%">${d.pelanggan_alamat}</td>
                                <td class="numeric-cell" style="width: 20%">${d.pelanggan_notelp}</td>
                                <td class="label-cell"><p class="grid grid-cols-2 grid-gap"><button class="button button-small button-tonal" onclick="editPelanggan(${d.pelanggan_id}, '${d.pelanggan_nama}', '${d.pelanggan_alamat}', '${d.pelanggan_notelp}',)">Edit</button><button class="button button-small button-tonal color-red" onclick="#">Hapus</button></p></td>
                          </tr>
                        `
                    })
                    $('#daftar-pelanggan').html(temp)    
                }
            })
        }

        function tambahPelanggan() {
            let pelanggan_nama = $("input[name=pelanggan_nama]").val();
            let pelanggan_alamat = $("input[name=pelanggan_alamat]").val();
            let pelanggan_notelp = $("input[name=pelanggan_notelp]").val();
            if(pelanggan_nama == "" || pelanggan_alamat == "" || pelanggan_notelp == ""){
                app.dialog.alert("Isian Masih Kosong, Silahkan Cek Kembali","Error");
                return;
            }
            $.ajax({
                url: "http://localhost/api_toko/Pelanggan/insert",
                method: "POST",
                data: {pelanggan_nama: pelanggan_nama, pelanggan_alamat: pelanggan_alamat, pelanggan_notelp: pelanggan_notelp},
                success: function(){
                    app.dialog.alert("Data Berhasil Di Input","Success");
                    app.views.main.router.back();
                },
                error: function(){
                    app.dialog.alert("Tidak Terhubung dengan Server!","Error");
                }
            })
        }

        function editPelanggan(id, nama, alamat, notelp) {
            localStorage.setItem("kodePelanggan", id);
            localStorage.setItem("namaPelanggan", nama);
            localStorage.setItem("alamatPelanggan", alamat);
            localStorage.setItem("notelpPelanggan", notelp);
            app.views.main.router.navigate("/editplgn/");
        }

        function tampilSupplier() {
            $.ajax({
                type: "GET",
                url: "http://localhost/api_toko/Supplier",
                success: function(result) {
                    let dt = "";
                    let res = JSON.parse(result);
                    // console.log(res.data)
                    let temp = '';

                    res.data.forEach((d) => {
                        temp += `
                            <tr>
                                <td class="label-cell" style="width: 40%">${d.suplier_nama}</td>
                                <td class="label-cell" style="width: 30%">${d.suplier_alamat}</td>
                                <td class="numeric-cell" style="width: 20%">${d.suplier_notelp}</td>
                                <td class="label-cell"><p class="grid grid-cols-2 grid-gap"><button class="button button-small button-tonal" onclick="editSupplier(${d.suplier_id}, '${d.suplier_nama}', '${d.suplier_alamat}', '${d.suplier_notelp}')">Edit</button><button class="button button-small button-tonal color-red" onclick="#">Hapus</button></p></td>
                          </tr>
                        `
                    })
                    $('#daftar-supplier').html(temp)    
                }
            })
        }

        function tambahSupplier() {
            let suplier_nama = $("input[name=suplier_nama]").val();
            let suplier_alamat = $("input[name=suplier_alamat]").val();
            let suplier_notelp = $("input[name=suplier_notelp]").val();
            if(suplier_nama == "" || suplier_alamat == "" || suplier_notelp == ""){
                app.dialog.alert("Isian Masih Kosong, Silahkan Cek Kembali","Error");
                return;
            }
            $.ajax({
                url: "http://localhost/api_toko/Supplier/insert",
                method: "POST",
                data: {suplier_nama: suplier_nama, suplier_alamat: suplier_alamat, suplier_notelp: suplier_notelp},
                success: function(){
                    app.dialog.alert("Data Berhasil Di Input","Success");
                    app.views.main.router.back();
                },
                error: function(){
                    app.dialog.alert("Tidak Terhubung dengan Server!","Error");
                }
            })
        }

        function editSupplier(id, nama, alamat, notelp) {
            localStorage.setItem("kodeSupplier", id);
            localStorage.setItem("namaSupplier", nama);
            localStorage.setItem("alamatSupplier", alamat);
            localStorage.setItem("notelpSupplier", notelp);
            app.views.main.router.navigate("/editsupplier/");
        }

        function tampilUtang() {
            $.ajax({
                type: "GET",
                url: "http://localhost/api_toko/Utang",
                success: function(result) {
                    let dt = "";
                    let res = JSON.parse(result);
                    // console.log(res.data)
                    let temp = '';

                    res.data.forEach((d) => {
                        temp += `
                            <tr>
                                <td class="label-cell" style="width: 40%">${d.suplier_nama}</td>
                                <td class="numeric-cell" style="width: 30%">${d.tgl_transaksi}</td>
                                <td class="numeric-cell" style="width: 20%">${d.jml_transaksi}</td>
                                <td class="numeric-cell" style="width: 20%">${d.jml_dibayar}</td>
                                <td class="numeric-cell" style="width: 20%">${d.jml_kekurangan}</td>
                                <td class="label-cell"><button class="button button-small button-tonal" onclick="#">Edit</button></td>
                          </tr>
                        `
                    })
                    $('#daftar-utang').html(temp)    
                }
            })
        }

        function tampilPiutang() {
            $.ajax({
                type: "GET",
                url: "http://localhost/api_toko/Piutang",
                success: function(result) {
                    let dt = "";
                    let res = JSON.parse(result);
                    // console.log(res.data)
                    let temp = '';

                    res.data.forEach((d) => {
                        temp += `
                            <tr>
                                <td class="label-cell" style="width: 40%">${d.pelanggan_nama}</td>
                                <td class="numeric-cell" style="width: 30%">${d.tgl_transaksi}</td>
                                <td class="numeric-cell" style="width: 20%">${d.jml_transaksi}</td>
                                <td class="numeric-cell" style="width: 20%">${d.jml_dibayar}</td>
                                <td class="numeric-cell" style="width: 20%">${d.jml_kekurangan}</td>
                                <td class="label-cell"><button class="button button-small button-tonal" onclick="#">Edit</button></td>
                          </tr>
                        `
                    })
                    $('#daftar-piutang').html(temp)    
                }
            })
        }
    </script>
</body>
</html>