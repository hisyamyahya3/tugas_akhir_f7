<template>
    <div class="page">
        <div class="navbar navbar-large navbar-transparent">
            <div class="navbar-bg"></div>
            <div class="navbar-inner sliding">
                <div class="left">
                    <a class="link back">
                        <i class="icon icon-back"></i>
                        <span class="if-not-md">Framework7</span>
                    </a>
                </div>
                <div class="title">Keranjang</div>
                <div class="title-large">
                    <div class="title-large-text">Keranjang</div>
                </div>
            </div>
        </div>
        <div class="toolbar tabbar tabbar-icons toolbar-bottom">
            <div class="toolbar-inner">
                <a href="#penjualan" class="tab-link tab-link-active">
                    <i class="icon f7-icons if-not-md">shopping_cart</i>
                    <i class="icon material-icons md-only">shopping_cart<span class="badge color-red" id="hitungPenjualan"></span></i>
                    <span class="tabbar-label">Penjualan</span>
                </a>
                <a href="#pembelian" class="tab-link">
                    <i class="icon f7-icons if-not-md">shopping_cart</i>
                    <i class="icon material-icons md-only">shopping_cart<span class="badge color-red" id="hitungPembelian"></span></i>
                    <span class="tabbar-label">Pembelian</span>
                </a>
            </div>
        </div>
        <swiper-container class="tabs">
            <swiper-slide id="penjualan" class="page-content tab tab-active">
                <div class="grid grid-cols" id="keranjangPenjualan">
            
                </div>
                <div class="teks-tengah" id="nodata">

                </div>
            </swiper-slide>
            <swiper-slide id="pembelian" class="page-content tab">
                <div class="grid grid-cols" id="keranjangPembelian">

                </div>
                <div class="teks-tengah" id="nodata1">

                </div>
            </swiper-slide>
        </swiper-container>
    </div>
</template>
<script>
    export default function (props, ctx) {
        ctx.$on('pageAfterIn', () => {
            tampilKeranjangPenjualan()
            tampilKeranjangPembelian()

            let userID = localStorage.getItem("userID");

            $.ajax({
                url: "http://localhost/api_toko/Pelanggan/hitungKeranjang",
                method: "POST",
                data: {
                    userID: userID
                },
                success: function (result) {
                    let res = JSON.parse(result)

                    if (res.data.count === 0) {
                        $("#hitungPenjualan").addClass("badge-disabled").text("");
                    }

                    let itemCount = res.data.count
                    $("#hitungPenjualan").removeClass("badge-disabled").text(itemCount);
                },
                error: function () {
                    app.dialog.alert("Tidak Terhubung dengan Server!", "Error");
                }
            })

            $.ajax({
                url: "http://localhost/api_toko/Supplier/hitungKeranjang",
                method: "POST",
                data: {
                    userID: userID
                },
                success: function (result) {
                    let res = JSON.parse(result)

                    if (res.data.count === 0) {
                        $("#hitungPembelian").addClass("badge-disabled").text("");
                    }

                    let itemCount = res.data.count
                    $("#hitungPembelian").removeClass("badge-disabled").text(itemCount);
                },
                error: function () {
                    app.dialog.alert("Tidak Terhubung dengan Server!", "Error");
                }
            })
        })

        return $render;
    };
</script>